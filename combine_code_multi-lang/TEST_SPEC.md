# Combine Code Utility - Language Agnostic Test Specification

This document outlines a set of test cases and scenarios to verify the correct behavior of any implementation of the `combine_code` utility, based on the language-agnostic description in `README.md`. The goal is to ensure functional consistency across different language implementations.

Each test case describes a scenario, the expected input (directory structure, filter files), the command to run (for non-interactive mode), the expected output or behavior, and whether the test is **Required** or **Desirable (Flexible)** based on the program specification.

## Test Setup

For each test case, a temporary directory should be created with the specified structure and files. The `combine_code` utility implementation being tested should be run from a location *outside* this temporary directory, using the temporary directory's path as the `root_dir` argument.

The output file (`combined_code.txt` or equivalent) generated by the utility should be compared against the expected output content. The output file should be created in the directory where the utility is executed.

## Test Cases

### Test Case 1: Basic Combination (No Filtering)

**Scenario:** Combine all files in a simple directory structure without any filter file present.
**Input Structure:**
```
test_root/
├── file1.txt
├── subdir/
│   └── file2.txt
└── file3.md
```
**Filter Files:** None (`.copyignore` or `.copyinclude` should not exist in `test_root/`).
**Command (Non-interactive):** `run_combine_code <path_to_test_root>` (using default blacklist mode with no filter file)
**Expected Output (`combined_code.txt` - located in the execution directory):**
```
==== Run Parameters ====
... (Parameters should reflect the run)

==== File: file1.txt ====

Content of file1.txt

==== File: subdir/file2.txt ====

Content of file2.txt

==== File: file3.md ====

Content of file3.md

--- Directory Structure ---
test_root/
    file1.txt
subdir/
    file2.txt
    file3.md
```
*(Note: The exact order of files in the output might vary depending on the file system traversal order, but all files should be present. The directory structure should reflect all files and directories under `test_root`.)*
**Status:** Required

### Test Case 2: Blacklist Filtering (.copyignore) - File Exclusion

**Scenario:** Exclude a specific file using a `.copyignore` file.
**Input Structure:**
```
test_root/
├── .copyignore
├── file_a.txt
├── file_b.log
└── file_c.txt
```
**Filter File (`test_root/.copyignore`):**
```
*.log
```
**Command (Non-interactive):** `run_combine_code <path_to_test_root> <path_to_test_root>/.copyignore blacklist`
**Expected Output (`combined_code.txt` - located in the execution directory):**
```
==== Run Parameters ====
... (Parameters should reflect the run, including filter file path and mode)

==== .copyignore Contents ====
*.log


==== File: file_a.txt ====

Content of file_a.txt

==== File: file_c.txt ====

Content of file_c.txt

--- Directory Structure ---
test_root/
    file_a.txt
    file_c.txt
```
**Status:** Required

### Test Case 3: Whitelist Filtering (.copyinclude) - File Inclusion

**Scenario:** Include only specific files using a `.copyinclude` file.
**Input Structure:**
```
test_root/
├── .copyinclude
├── file_x.txt
├── file_y.js
└── file_z.txt
```
**Filter File (`test_root/.copyinclude`):**
```
*.txt
```
**Command (Non-interactive):** `run_combine_code <path_to_test_root> <path_to_test_root>/.copyinclude whitelist`
**Expected Output (`combined_code.txt` - located in the execution directory):**
```
==== Run Parameters ====
... (Parameters should reflect the run, including filter file path and mode)

==== .copyinclude Contents ====
*.txt


==== File: file_x.txt ====

Content of file_x.txt

==== File: file_z.txt ====

Content of file_z.txt

--- Directory Structure ---
test_root/
    file_x.txt
    file_z.txt
```
**Status:** Required

### Test Case 4: Missing Filter File (Blacklist)

**Scenario:** Run the utility in blacklist mode when the default `.copyignore` file is missing.
**Input Structure:**
```
test_root/
├── file1.txt
└── subdir/
    └── file2.txt
```
**Filter Files:** None.
**Command (Non-interactive):** `run_combine_code <path_to_test_root> blacklist` (filter file path not specified, default `.copyignore` is missing)
**Expected Output (`combined_code.txt` - located in the execution directory):** Should be the same as Test Case 1 (Basic Combination), as a missing filter file in blacklist mode should result in no filtering.
**Status:** Desirable (Flexible) - Handling a missing filter file without error is desirable.

### Test Case 5: Invalid Root Directory

**Scenario:** Run the utility with a root directory that does not exist.
**Input Structure:** None (or any structure, the utility should fail before processing).
**Filter Files:** N/A.
**Command (Non-interactive):** `run_combine_code /path/to/nonexistent/directory`
**Expected Behavior:** The utility should print an error message indicating the directory was not found and exit with a non-zero status code.
**Status:** Required

### Test Case 6: Empty Root Directory

**Scenario:** Run the utility on an empty directory.
**Input Structure:**
```
empty_root/
```
**Filter Files:** None.
**Command (Non-interactive):** `run_combine_code <path_to_empty_root>`
**Expected Output (`combined_code.txt` - located in the execution directory):**
```
==== Run Parameters ====
... (Parameters should reflect the run)

==== .copyignore Contents ====


--- Directory Structure ---
empty_root/
```
*(Note: The file content section should be empty, and the directory structure should just show the root directory.)*
**Status:** Required

### Test Case 7: File with Special Characters

**Scenario:** Ensure files with spaces or special characters in their names are handled correctly.
**Input Structure:**
```
test_root/
└── file with spaces & (symbols).txt
```
**Filter Files:** None.
**Command (Non-interactive):** `run_combine_code <path_to_test_root>`
**Expected Output (`combined_code.txt` - located in the execution directory):**
```
==== Run Parameters ====
...

==== .copyignore Contents ====


==== File: file with spaces & (symbols).txt ====

Content of file with spaces & (symbols).txt

--- Directory Structure ---
test_root/
    file with spaces & (symbols).txt
```
*(Note: The file path in the header and structure should be correctly represented.)*
**Status:** Required

### Test Case 8: File Reading Error

**Scenario:** Test handling of a file that cannot be read (e.g., due to permissions).
**Input Structure:**
```
test_root/
├── readable_file.txt
└── unreadable_file.txt  (Permissions set to prevent reading by the user/process)
```
**Filter Files:** None.
**Command (Non-interactive):** `run_combine_code <path_to_test_root>`
**Expected Behavior:** The utility should handle the error gracefully (e.g., print a warning or error message for the specific file) and continue processing other readable files. It should not crash or exit prematurely. The `unreadable_file.txt` should not appear in the output content or directory structure.
**Status:** Required

### Test Case 9: Blacklist Filtering (.copyignore) - Directory Exclusion

**Scenario:** Exclude an entire directory using a `.copyignore` file.
**Input Structure:**
```
test_root/
├── .copyignore
├── file_a.txt
├── excluded_dir/
│   ├── file_in_excluded.txt
│   └── another_file.md
└── included_dir/
    └── file_in_included.txt
```
**Filter File (`test_root/.copyignore`):**
```
excluded_dir/
```
**Command (Non-interactive):** `run_combine_code <path_to_test_root> <path_to_test_root>/.copyignore blacklist`
**Expected Output (`combined_code.txt` - located in the execution directory):**
```
==== Run Parameters ====
... (Parameters should reflect the run, including filter file path and mode)

==== .copyignore Contents ====
excluded_dir/


==== File: file_a.txt ====

Content of file_a.txt

==== File: included_dir/file_in_included.txt ====

Content of file_in_included.txt

--- Directory Structure ---
test_root/
    file_a.txt
included_dir/
    file_in_included.txt
```
*(Note: The `excluded_dir/` and its contents should not appear in the output content or directory structure.)*
**Status:** Desirable (Flexible)

### Test Case 10: Whitelist Filtering (.copyinclude) - Directory Inclusion

**Scenario:** Include only a specific directory and its contents using a `.copyinclude` file.
**Input Structure:**
```
test_root/
├── .copyinclude
├── file_a.txt
├── included_dir/
│   ├── file_in_included.txt
│   └── another_file.md
└── excluded_dir/
    └── file_in_excluded.txt
```
**Filter File (`test_root/.copyinclude`):**
```
included_dir/
```
**Command (Non-interactive):** `run_combine_code <path_to_test_root> <path_to_test_root>/.copyinclude whitelist`
**Expected Output (`combined_code.txt` - located in the execution directory):**
```
==== Run Parameters ====
... (Parameters should reflect the run, including filter file path and mode)

==== .copyinclude Contents ====
included_dir/


==== File: included_dir/file_in_included.txt ====

Content of file_in_included.txt

==== File: included_dir/another_file.md ====

Content of another_file.md

--- Directory Structure ---
test_root/
included_dir/
    file_in_included.txt
    another_file.md
```
*(Note: `file_a.txt` and the `excluded_dir/` and its contents should not appear in the output content or directory structure.)*
**Status:** Desirable (Flexible)

### Test Case 11: Glob Pattern Matching (if implemented)

**Scenario:** Test glob patterns in filter files (e.g., `*.cs`, `src/*`, `**/temp/*`).
**Input Structure:**
```
test_root/
├── file.cs
├── file.txt
├── src/
│   ├── main.cs
│   └── temp/
│       └── temp.txt
└── obj/
    └── generated.cs
```
**Filter File (`test_root/.copyignore`):**
```
*.txt
**/temp/*
obj/
```
**Command (Non-interactive):** `run_combine_code <path_to_test_root> <path_to_test_root>/.copyignore blacklist`
**Expected Output (`combined_code.txt` - located in the execution directory):**
```
==== Run Parameters ====
...

==== .copyignore Contents ====
*.txt
**/temp/*
obj/


==== File: file.cs ====

Content of file.cs

==== File: src/main.cs ====

Content of src/main.cs

--- Directory Structure ---
test_root/
    file.cs
src/
    main.cs
```
*(Note: `file.txt`, `src/temp/temp.txt`, and the entire `obj/` directory should be excluded if glob and directory filtering are fully implemented.)*
**Status:** Desirable (Flexible)

### Interactive Mode Test (Desirable)

**Scenario:** Test the interactive prompts if implemented.
**Steps:**
1. Run the utility without command-line arguments: `run_combine_code`
2. Verify prompts for mode, applying filter to structure, and root directory appear.
3. Test providing valid and invalid inputs at each prompt.
4. Verify that the utility proceeds correctly after valid inputs and provides appropriate feedback for invalid inputs.
**Status:** Desirable (Flexible)

This test specification provides a basis for verifying the correctness and consistency of `combine_code` utility implementations across different languages, explicitly marking required and desirable test coverage.
